<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Color Palette Extractor — FreeToolHub</title>
<link rel="stylesheet" href="../style.css"/>
<style>
.container{max-width:900px;margin:40px auto;padding:20px}
.card{background:#fff;border-radius:14px;padding:24px;box-shadow:0 8px 30px rgba(13,20,35,0.06)}
.palette{display:flex;gap:12px;flex-wrap:wrap;margin-top:20px}
.swatch{width:80px;height:80px;border-radius:10px;display:flex;align-items:flex-end;justify-content:center;color:#fff;font-size:12px;padding-bottom:6px;font-weight:bold;box-shadow:inset 0 -20px 40px rgba(0,0,0,0.15)}
.preview-img{max-width:320px;border-radius:10px;margin-top:10px}
.small{padding:8px 14px;border-radius:8px}
</style>
</head>
<body>

<div class="container">
  <a href="../index.html" style="color:#2563eb;text-decoration:none;">← Back</a>
  <div class="card">
    <h2>Color Palette Extractor</h2>
    <p class="muted">Extract dominant colors + preview + downloadable palette image!</p>

    <input id="file" type="file" accept="image/*">
    <button id="extract" class="small" style="background:#2563eb;color:#fff;border:none;">Extract</button>
    <button id="download" class="small" style="display:none;">Download Palette</button>

    <div id="imgPreview"></div>
    <div id="palette" class="palette"></div>
  </div>
</div>

<script src="https://unpkg.com/node-vibrant@3.2.0/dist/vibrant.min.js"></script>
<script>
const file = document.getElementById("file");
const extractBtn = document.getElementById("extract");
const paletteDiv = document.getElementById("palette");
const imgPreview = document.getElementById("imgPreview");
const downloadBtn = document.getElementById("download");

extractBtn.addEventListener("click", async () => {
  const f = file.files[0];
  if (!f) return alert("Choose an image");

  const url = URL.createObjectURL(f);

  // Show preview
  imgPreview.innerHTML = `<img src="${url}" class="preview-img"/>`;

  const v = new Vibrant(url);
  const pal = await v.getPalette();

  paletteDiv.innerHTML = "";

  const colors = [];
  Object.keys(pal).forEach(k => {
    if (pal[k]) colors.push(pal[k].getHex());
  });

  colors.forEach(hex => {
    const d = document.createElement("div");
    d.className = "swatch";
    d.style.background = hex;
    d.textContent = hex;
    paletteDiv.appendChild(d);
  });

  // ——— create palette image to download ———
  const canvas = document.createElement("canvas");
  canvas.width = 100 * colors.length;
  canvas.height = 100;
  const ctx = canvas.getContext("2d");

  colors.forEach((c,i)=>{
    ctx.fillStyle = c;
    ctx.fillRect(i*100,0,100,100);
    ctx.fillStyle = "rgba(0,0,0,0.6)";
    ctx.font = "14px sans-serif";
    ctx.fillText(c, i*100+8, 90);
  });

  canvas.toBlob(b=>{
    downloadBtn.href = URL.createObjectURL(b);
    downloadBtn.download = "palette.png";
    downloadBtn.style.display = "inline-block";
  });
});
</script>
</body>
</html>
